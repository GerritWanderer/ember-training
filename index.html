<!DOCTYPE HTML>

<html>
  <head>
    <meta charset='utf-8'>
    <title>Emberdio</title>
    <link rel="stylesheet" href="css/app.css">

    <script src="js/libs/handlebars-1.0.rc.2.js"></script>
    <script src="js/libs/jquery-1.8.3.js"></script>
    <script src="js/libs/ember.js"></script>
    <script src="js/libs/ember-data.js"></script>
    <script src="js/app.js"></script>

    <script>
      function loadScript(name) {
        // Replace < symbol with its hex code in order to not make the HTML parser
        // think we've ended the script.
        // http://stackoverflow.com/questions/8231048/why-use-x3c-instead-of-when-generating-html-from-javascript
        document.write('<script src="' + name + '">\x3C/script>');
      }

      function loadCSS(name) {
        document.write('<link href="' + name + '" rel="stylesheet">');
      }

      if (~location.search.indexOf('tests=true')) {
        loadScript('tests/helpers.js');
        loadScript('tests/vendor/qunit.js');
        loadScript('tests/step1.js');
        loadScript('tests/step2.js');
        loadScript('tests/step3.js');
        loadScript('tests/step4.js');
        loadScript('tests/step5.js');

        loadCSS('tests/vendor/qunit.css');
      }
    </script>
  </head>
  <body>
    <script type="text/x-handlebars">
      <header>
        {{#linkTo "index"}}
          <h1>BümBöx</h1>
        {{/linkTo}}
      </header>
      {{outlet}}
      {{view App.AudioView src="audio/Lame_Drivers_-_01_-_Frozen_Egg.mp3"}}
    </script>

    <script type="text/x-handlebars" data-template-name="index">
      <div class="album-list">
        {{#each controller}}
          <div class="album">
            {{#linkTo "album" this}}
              <img {{bindAttr src="artwork"}}>
            {{/linkTo}}
            <p class="album-name">{{name}}</p>
            <p class="artist-name">{{artist}}</p>
            <p class="song-count">8 songs{{#if isExplicit}}<span class='explicit'>EXPLICIT</span>{{/if}}</p>
          </div>
        {{/each}}
      </div>
    </script>

    <script type="text/x-handlebars" data-template-name="album">
      <div class="album-info">
        <img {{bindAttr src="artwork"}}>
        <h1>{{name}}</h1>
        <h2>{{artist}}</h2>
      </div>
      <table class="album-listing">
        {{#each song in songs}}
          <tr>
            <td class="song-track">{{song.track}}</td>
            <td class="song-name">{{song.name}}</td>
            <td class="song-duration">{{minutes song.duration}}</td>
          </tr>
        {{/each}}
      </table>
    </script>

    <script type="text/x-handlebars" data-template-name="audio-control">
      <audio {{bindAttr src="view.src"}}></audio>
      {{#if view.isPlaying}}
        <button {{action "pauseSong" target=view}}>Pause</button>
        {{else}}
        <button {{action "playSong" target=view}}>Play</button>
      {{/if}}

      {{#if view.isLoaded}}
        <p>{{minutes view.currentTime}}</p>
        <input type="range" min="0" {{bindAttr max="view.duration" value="view.currentTime"}}>
      {{else}}
        <p>Loading...</p>
      {{/if}}
    </script>
    <div id="qunit" style="display: none"></div>
    <div id="qunit-fixture" style="display: none"></div>
  </body>
</html>
