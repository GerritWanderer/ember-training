<!DOCTYPE HTML>

<html>
  <head>
    <meta charset='utf-8'>
    <title>BümBöx</title>
    <link rel="stylesheet" href="css/app.css">

    <script src="js/libs/handlebars-1.0.rc.2.js"></script>
    <script src="js/libs/jquery-1.8.3.js"></script>
    <script src="js/libs/ember.js"></script>
    <script src="js/libs/ember-data.js"></script>
    <script src="js/app.js"></script>

    <script src="tests/load-tests.js"></script>
  </head>
  <body>
    <script type="text/x-handlebars">
      <header>
        {{#linkTo "index"}}
          <h1>BümBöx</h1>
        {{/linkTo}}
      </header>
      {{outlet}}

      {{render "nowPlaying"}}
    </script>

    <script type="text/x-handlebars" data-template-name="nowPlaying">
      <footer class="now-playing">
        {{#if model}}
          <img class="now-playing-artwork" {{bindAttr src="album.artwork"}}>
          <div class="now-playing-body">
            <p class="now-playing-details">
              <span class="now-playing-name">{{name}}</span> -
              <span class="now-playing-artist">{{album.artist}}</span>
            </p>
            <div class="now-playing-player">
              {{view App.AudioView srcBinding=url}}
            </div>
          </div>
          <button {{action "showQueue"}}>{{nextSongs.length}} songs in queue</button>
        {{else}}
          <span class="now-playing-empty">Select a song to start playing.</span>
        {{/if}}
      </footer>

      {{#if showingQueue}}
        <div style="position: absolute; top: 100px; right: 100px; left: 100px; bottom: 100px; border: 1px solid gray; background: white">

          <table class="album-listing">
            <tbody>
              {{#each song in nextSongs itemController="song"}}
                <tr {{bindAttr class="isCurrentlyPlaying:playing"}}>
                  <td class="song-track">
                    <span class="track-number">{{song.track}}</span>
                    <span class="play" {{action "togglePlay"}}>▶</span><!-- FIXME: action context still changes? -->
                    <span class="pause" {{action "togglePlay"}}>❙❙</span>
                  </td>
                  <td class="song-name">{{song.name}}</td>
                  <td class="song-duration">{{format-duration song.duration}}</td>
                  <td><button {{action "addToQueue"}}>Queue</button></td>
                </tr>
              {{/each}}
            </tbody>
          </table>
        </div>
      {{/if}}
    </script>

    <script type="text/x-handlebars" data-template-name="index">
      <div class="album-list">
        {{#each controller}}
          <div class="album">
            {{#linkTo "album" this}}
              <img {{bindAttr src="artwork"}}>
            {{/linkTo}}
            <p class="album-name">{{name}}</p>
            <p class="artist-name">{{artist}}</p>
            <p class="song-count">
              8 songs
              {{#if isExplicit}}
                <span class='explicit'>EXPLICIT</span>
              {{/if}}
            </p>
          </div>
        {{/each}}
      </div>
    </script>

    <script type="text/x-handlebars" data-template-name="album">
      <div class="album-info">
        <img {{bindAttr src="artwork"}}>
        <h1>{{name}}</h1>
        <h2>{{artist}}</h2>
      </div>
      <table class="album-listing">
        <tbody>
        {{#each song in songs itemController="song"}}
          <tr {{bindAttr class="isCurrentlyPlaying:playing"}}>
            <td class="song-track">
              <span class="track-number">{{song.track}}</span>
              <span class="play" {{action "togglePlay"}}>▶</span><!-- FIXME: action context still changes? -->
              <span class="pause" {{action "togglePlay"}}>❙❙</span>
            </td>
            <td class="song-name">{{song.name}}</td>
            <td class="song-duration">{{format-duration song.duration}}</td>
            <td><button {{action "addToQueue"}}>Queue</button></td>
            <td><div draggable="true">HERP</div></td>
          </tr>
        {{/each}}
        <tr>
          <td class="total-duration" colspan="3">Total Time: {{format-duration totalDuration}}</td>
        </tr>
        </tbody>
      </table>
    </script>

    <script type="text/x-handlebars" data-template-name="audio-control">
      <audio {{bindAttr src="view.src"}} autoplay></audio>
      {{#if view.isPlaying}}
        <button class='pause' {{action "pauseSong" target=view}}>❙❙</button>
        {{else}}
        <button class='play' {{action "playSong" target=view}}>▶</button>
      {{/if}}
      <button {{action "playNextSong" target=controller}}>&raquo;</button>

      {{#if view.isLoaded}}
        <input type="range" min="0" {{bindAttr max="view.duration" value="view.currentTime"}}>
        <p class='duration' {{action "toggleTimeDisplay" target=view}}>
          {{format-duration view.displayTime}}
        </p>
      {{else}}
        <p class='loading'>Loading...</p>
      {{/if}}
    </script>

    <div id="qunit" style="display: none"></div>
    <div id="qunit-fixture" style="display: none"></div>
  </body>
</html>
